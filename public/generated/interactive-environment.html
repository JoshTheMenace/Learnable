<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Environment</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        canvas {
            border: 4px solid #333;
            background: white;
        }
    </style>
</head>
<body>
    <h2>ðŸŽ® Interactive Visualization</h2>
    <div id="p5-container"></div>

    <script>
        let rocks = [];
let processes = [];
let selectedRock = null;
let infoBoxVisible = false;
let rockInfo = {
  igneous: {
    name: "Igneous Rock",
    description: "Formed when magma or lava cools and solidifies. Examples include granite and basalt.",
    formation: "Created from cooling of molten rock (magma/lava)"
  },
  sedimentary: {
    name: "Sedimentary Rock",
    description: "Formed from sediment that has been compacted and cemented together. Examples include limestone and sandstone.",
    formation: "Created from weathered rock fragments and sediments"
  },
  metamorphic: {
    name: "Metamorphic Rock",
    description: "Formed when existing rocks are changed by heat or pressure. Examples include marble and slate.",
    formation: "Created from existing rocks under heat and pressure"
  }
};

function setup() {
  createCanvas(800, 600);
  
  // Create rock samples
  rocks.push(new Rock(200, 150, 'igneous', color(180, 100, 80)));
  rocks.push(new Rock(600, 150, 'sedimentary', color(220, 200, 150)));
  rocks.push(new Rock(400, 450, 'metamorphic', color(120, 120, 120)));
  
  // Create processes
  processes.push(new Process(400, 50, 'melting', 'igneous', 'sedimentary'));
  processes.push(new Process(650, 300, 'heat & pressure', 'sedimentary', 'metamorphic'));
  processes.push(new Process(150, 300, 'weathering & erosion', 'igneous', 'sedimentary'));
  processes.push(new Process(400, 550, 'melting', 'metamorphic', 'igneous'));
  processes.push(new Process(550, 300, 'weathering & erosion', 'metamorphic', 'sedimentary'));
  processes.push(new Process(250, 300, 'heat & pressure', 'igneous', 'metamorphic'));
}

function draw() {
  background(135, 206, 235); // Sky blue background
  
  // Draw ground
  fill(34, 139, 34); // Forest green
  rect(0, 500, width, 100);
  
  // Draw magma chamber
  fill(255, 69, 0, 150); // Red-orange with transparency
  rect(0, 550, width, 50);
  
  // Draw processes
  for (let process of processes) {
    process.display();
    process.animate();
  }
  
  // Draw rocks
  for (let rock of rocks) {
    rock.display();
    rock.update();
  }
  
  // Draw info box if a rock is selected
  if (infoBoxVisible && selectedRock) {
    drawInfoBox(selectedRock.type);
  }
  
  // Draw title
  fill(0);
  textSize(24);
  textAlign(CENTER);
  text("The Rock Cycle", width/2, 30);
  
  // Draw instructions
  textSize(14);
  text("Click on any rock to learn more about it", width/2, height - 20);
}

function mousePressed() {
  // Check if any rock was clicked
  for (let rock of rocks) {
    let d = dist(mouseX, mouseY, rock.x, rock.y);
    if (d < rock.size) {
      selectedRock = rock;
      infoBoxVisible = true;
      break;
    }
  }
  
  // If clicked outside rocks, hide info box
  if (!infoBoxVisible) {
    infoBoxVisible = false;
  }
}

function keyPressed() {
  // Press ESC to close info box
  if (keyCode === ESCAPE) {
    infoBoxVisible = false;
  }
}

class Rock {
  constructor(x, y, type, clr) {
    this.x = x;
    this.y = y;
    this.type = type;
    this.color = clr;
    this.size = 50;
    this.particles = [];
    this.shakeAmount = 0;
  }
  
  display() {
    // Draw rock
    fill(this.color);
    stroke(0);
    strokeWeight(2);
    ellipse(this.x, this.y, this.size);
    
    // Draw particles if weathering
    for (let particle of this.particles) {
      particle.display();
    }
    
    // Draw label
    fill(0);
    noStroke();
    textSize(12);
    textAlign(CENTER);
    text(this.type.charAt(0).toUpperCase() + this.type.slice(1), this.x, this.y + this.size/2 + 15);
  }
  
  update() {
    // Update particles
    for (let i = this.particles.length - 1; i >= 0; i--) {
      this.particles[i].update();
      if (this.particles[i].life <= 0) {
        this.particles.splice(i, 1);
      }
    }
  }
  
  // Weathering effect - break rock into particles
  weather() {
    for (let i = 0; i < 5; i++) {
      this.particles.push(new Particle(this.x, this.y, this.color));
    }
    this.shakeAmount = 10;
  }
  
  // Heat and pressure effect - change color and size
  metamorphose() {
    this.shakeAmount = 5;
  }
  
  // Melting effect - move to magma chamber
  melt() {
    this.shakeAmount = 0;
  }
}

class Process {
  constructor(x, y, name, fromType, toType) {
    this.x = x;
    this.y = y;
    this.name = name;
    this.fromType = fromType;
    this.toType = toType;
    this.animationPhase = 0;
    this.active = false;
  }
  
  display() {
    // Draw process label
    fill(0);
    noStroke();
    textSize(12);
    textAlign(CENTER);
    text(this.name, this.x, this.y);
    
    // Draw arrow
    stroke(0);
    strokeWeight(2);
    fill(0);
    let arrowLength = 100;
    let angle = this.getArrowAngle();
    
    push();
    translate(this.x, this.y);
    rotate(angle);
    
    // Draw arrow line
    line(0, 0, arrowLength, 0);
    
    // Draw arrowhead
    let arrowSize = 8;
    line(arrowLength, 0, arrowLength - arrowSize, -arrowSize);
    line(arrowLength, 0, arrowLength - arrowSize, arrowSize);
    
    pop();
  }
  
  animate() {
    this.animationPhase += 0.02;
    
    // Animate different processes
    if (this.name === 'weathering & erosion') {
      // Draw moving particles
      stroke(this.getColor());
      strokeWeight(3);
      
      for (let i = 0; i < 5; i++) {
        let offset = sin(this.animationPhase + i) * 20;
        let x = this.x + offset;
        let y = this.y + i * 10;
        point(x, y);
      }
    } else if (this.name === 'heat & pressure') {
      // Draw heat waves
      noFill();
      stroke(this.getColor());
      strokeWeight(1);
      
      for (let i = 0; i < 3; i++) {
        let radius = 20 + sin(this.animationPhase + i) * 5;
        ellipse(this.x, this.y, radius, radius/2);
      }
    } else if (this.name === 'melting') {
      // Draw melting effect
      stroke(this.getColor());
      strokeWeight(2);
      
      for (let i = 0; i < 5; i++) {
        let waveHeight = sin(this.animationPhase * 2 + i) * 10;
        line(this.x - 20 + i*10, this.y, this.x - 20 + i*10, this.y + waveHeight);
      }
    }
  }
  
  getArrowAngle() {
    // Calculate arrow direction based on rock positions
    let fromRock = this.getRockByType(this.fromType);
    let toRock = this.getRockByType(this.toType);
    
    if (fromRock && toRock) {
      return atan2(toRock.y - fromRock.y, toRock.x - fromRock.x);
    }
    return 0;
  }
  
  getRockByType(type) {
    for (let rock of rocks) {
      if (rock.type === type) {
        return rock;
      }
    }
    return null;
  }
  
  getColor() {
    // Return color based on process type
    if (this.name === 'weathering & erosion') {
      return color(100, 100, 255);
    } else if (this.name === 'heat & pressure') {
      return color(255, 100, 100);
    } else if (this.name === 'melting') {
      return color(255, 165, 0);
    }
    return color(0);
  }
}

class Particle {
  constructor(x, y, clr) {
    this.x = x;
    this.y = y;
    this.color = clr;
    this.size = random(3, 8);
    this.vx = random(-2, 2);
    this.vy = random(-3, -1);
    this.life = 255;
  }
  
  display() {
    fill(red(this.color), green(this.color), blue(this.color), this.life);
    noStroke();
    ellipse(this.x, this.y, this.size);
  }
  
  update() {
    this.x += this.vx;
    this.y += this.vy;
    this.life -= 2;
    this.vy += 0.1; // Gravity effect
  }
}

function drawInfoBox(rockType) {
  // Draw info box background
  fill(255, 240);
  stroke(0);
  strokeWeight(2);
  rect(50, 50, width - 100, 150, 10);
  
  // Draw info text
  fill(0);
  noStroke();
  textAlign(LEFT);
  textSize(18);
  text(rockInfo[rockType].name, 70, 80);
  
  textSize(14);
  text(rockInfo[rockType].description, 70, 110, width - 140, 80);
  
  // Draw close instruction
  textSize(12);
  textAlign(RIGHT);
  text("Press ESC to close", width - 70, 190);
}
    </script>
</body>
</html>